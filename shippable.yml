language: ruby
rvm:
  - 2.1.2

env:
  global:
    - APP_NAME=morning-wave-1449
    - CI_REPORTS=shippable/testresults COVERAGE_REPORTS=shippable/codecoverage
    - secure: Pmvl+gDkPWUALWkd7whBjSf8dZHtEH8btBGIlCxHN7MDTQ6KI9HmUF1YfZSXqXf50cdZYhgm9YJLoLFW22iS00B8Ci6r495OzzWfiaNiX00SKugyB3xgRCyPyhhcH+uduA9wQd+o8ODnLs+j5/+Q1mWUsRUoZgtfZ43aZf82rLzUrOlJQShUOBCLHUM6GoiZO9nsgo6t7Mg/xTVW+E2JujNilGHvOLoUghaNnfF2OU4t6fdP/Qqk8bAE+mBFk9AUk0rpoYCG+AW+wcFSCbJJNpb7SrqL3J3aM1p6PjNohOJJ183Qw3r5h55TAs2Sz/BqLI6v2ygdI38DVovOZsKbSg==

before_install:
  - which heroku || wget -qO- https://toolbelt.heroku.com/install-ubuntu.sh | sh

before_script:
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage
  - psql -c 'create database "sample-rubyonrails-postgres-heroku_test";' -U postgres

after_success:
  - test -f ~/.ssh/id_rsa.heroku || ssh-keygen -y -f ~/.ssh/id_rsa > ~/.ssh/id_rsa.heroku && heroku keys:add ~/.ssh/id_rsa.heroku
  - git remote -v | grep ^heroku || heroku git:remote --app $APP_NAME
  - git push -f heroku master
  - heroku run rake db:migrate
